!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i(require("babylonjs"));else if("function"==typeof define&&define.amd)define(["babylonjs"],i);else{var s="object"==typeof exports?i(require("babylonjs")):i(t.BABYLON);for(var h in s)("object"==typeof exports?exports:t)[h]=s[h]}}(window,(function(t){return function(t){var i={};function s(h){if(i[h])return i[h].exports;var n=i[h]={i:h,l:!1,exports:{}};return t[h].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=t,s.c=i,s.d=function(t,i,h){s.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:h})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"h",{value:!0})},s.t=function(t,i){if(1&i&&(t=s(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.h)return t;var h=Object.create(null);if(s.r(h),Object.defineProperty(h,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var n in t)s.d(h,n,function(i){return t[i]}.bind(null,n));return h},s.n=function(t){var i=t&&t.h?function(){return t.default}:function(){return t};return s.d(i,"a",i),i},s.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},s.p="",s(s.s=1)}([function(i,s){i.exports=t},function(t,i,s){"use strict";s.r(i),s.d(i,"CharacterController",(function(){return n}));var h=s(0),n=function(){function t(t,i,s,n,f){var c=this;void 0===f&&(f=!1),this.u=3,this.v=2*this.u,this.k=2*this.u,this.M=this.u/2,this.j=2*this.M,this.g=2*this.u,this.O=this.u/2,this.F=2*this.O,this.L=this.u/2,this.R=2*this.L,this.q=Math.PI/8,this.B=2*this.q,this.S=9.8,this.C=30,this.J=45,this._=Math.PI*this.C/180,this.A=Math.PI*this.J/180,this.D=.25,this.G=0,this.H=h.Vector3.Zero(),this.I=new e("walk"),this.K=new e("walkBack"),this.N=new e("walkBackFast"),this.P=new e("idle"),this.T=new e("idleJump"),this.U=new e("run"),this.V=new e("runJump"),this.W=new e("fall"),this.X=new e("turnLeft"),this.Y=new e("turnLeftFast"),this.Z=new e("turnRight"),this.$=new e("turnRightFast"),this.tt=new e("strafeLeft"),this.it=new e("strafeLeftFast"),this.st=new e("strafeRight"),this.ht=new e("strafeRightFast"),this.nt=new e("slideBack"),this.et=[this.I,this.K,this.N,this.P,this.T,this.U,this.V,this.W,this.X,this.Y,this.Z,this.$,this.tt,this.it,this.st,this.ht,this.nt],this.ut="w",this.ft="s",this.ct="a",this.at="d",this.ot="q",this.rt="e",this.lt=" ",this.vt=!0,this.bt=h.Vector3.Zero(),this.wt=!1,this.mode=0,this.kt=0,this.Mt=!1,this.dt=-1,this.pt=!1,this.yt=!1,this.jt=null,this.gt=h.Vector3.Zero(),this.Ot=!1,this.xt=0,this.Ft=50,this.Lt=0,this.Rt=!1,this.qt=!1,this.Bt=!1,this.St=0,this.Ct=0,this.Jt=0,this._t=1,this.zt=!1,this.At=!1,this.Dt=0,this.Et=0,this.Gt=10,this.Ht=!0,this.It=!1,this.Kt=new h.Ray(h.Vector3.Zero(),h.Vector3.One(),1),this.Nt=h.Vector3.Zero(),this.Pt=.5,this.Qt=0,this.Tt=!1,this.Ut=!1,this.Vt=!1,this.Wt=t,this.Xt(t),this.setFaceForward(f),this.Yt=s,null!=n&&(this.Ut=!0,this.setAnimationGroups(n)),(this.Ut||null!==this.Zt)&&(this.Vt=!0),this.Ut||(this.Zt=t.skeleton),this.Ut||null==this.Zt||this.checkAnims(this.Zt),this.$t=i,this.Ht=this.$t.checkCollisions,this.ti=new u,this.ii=function(){c.si()},this.hi=function(t){c.ni(t)},this.ei=function(t){c.ui(t)}}return t.prototype.setAvatar=function(t){this.Wt=t},t.prototype.setAvatarSkeleton=function(t){this.Zt=t,this.checkAnims(t)},t.prototype.setSlopeLimit=function(t,i){this.C=t,this.J=i,this._=Math.PI*t/180,this.A=Math.PI*this.J/180},t.prototype.setStepOffset=function(t){this.D=t},t.prototype.setWalkSpeed=function(t){this.u=t},t.prototype.setRunSpeed=function(t){this.k=t},t.prototype.setBackSpeed=function(t){this.M=t},t.prototype.setBackFastSpeed=function(t){this.j=t},t.prototype.setJumpSpeed=function(t){this.g=t},t.prototype.setLeftSpeed=function(t){this.O=t},t.prototype.setLeftFastSpeed=function(t){this.F=t},t.prototype.setRightSpeed=function(t){this.L=t},t.prototype.setRightFastSpeed=function(t){this.R=t},t.prototype.setTurnSpeed=function(t){this.q=t*Math.PI/180},t.prototype.setTurnFastSpeed=function(t){this.B=t*Math.PI/180},t.prototype.setGravity=function(t){this.S=t},t.prototype.setAnimationGroups=function(t){this.Ut=!0;for(var i=0,s=this.et;i<s.length;i++){var h=s[i];null!=t[h.fi]&&(h.ci=t[h.fi],h.ai=!0,h.ci.name)}this.oi()},t.prototype.setAnimationRanges=function(t){var i;this.Ut=!1;for(var s=0,h=this.et;s<h.length;s++){var n=h[s];null!=(i=t[n.fi])&&(i instanceof Object?(i.name&&(n.fi=i.name),i.loop&&(n.ri=i.loop),i.rate&&(n.ri=i.rate)):n.fi=i,n.ai=!0)}},t.prototype.li=function(t,i,s,h){(this.Ut||null!=this.Zt)&&(null!=h&&(t.ri=h),this.Ut?(null!=i&&(t.ci=i,t.ai=!0),null!=s&&t.ai&&(t.vi=s,t.ci.speedRatio=s)):(null!=i&&(t.fi=i),null!=s&&(t.vi=s),null!=this.Zt.getAnimationRange(t.fi)?t.ai=!0:t.ai=!1))},t.prototype.enableBlending=function(t){if(this.Ut)for(var i=0,s=this.et;i<s.length;i++){var h=s[i];if(h.ai)for(var n=0,e=h.ci.targetedAnimations;n<e.length;n++){var u=e[n];u.animation.enableBlending=!0,u.animation.blendingSpeed=t}}else this.Zt.enableBlending(t)},t.prototype.disableBlending=function(){if(this.Ut)for(var t=0,i=this.et;t<i.length;t++){var s=i[t];if(s.ai)for(var h=0,n=s.ci.targetedAnimations;h<n.length;h++){n[h].animation.enableBlending=!1}}},t.prototype.setWalkAnim=function(t,i,s){this.li(this.I,t,i,s)},t.prototype.setRunAnim=function(t,i,s){this.li(this.U,t,i,s)},t.prototype.setWalkBackAnim=function(t,i,s){this.li(this.K,t,i,s),this.bi(this.N,this.K)},t.prototype.setWalkBackFastAnim=function(t,i,s){this.li(this.N,t,i,s)},t.prototype.setSlideBackAnim=function(t,i,s){this.li(this.nt,t,i,s)},t.prototype.setIdleAnim=function(t,i,s){this.li(this.P,t,i,s)},t.prototype.setTurnRightAnim=function(t,i,s){this.li(this.Z,t,i,s),this.bi(this.$,this.Z)},t.prototype.setTurnRightFastAnim=function(t,i,s){this.li(this.$,t,i,s)},t.prototype.setTurnLeftAnim=function(t,i,s){this.li(this.X,t,i,s),this.bi(this.Y,this.X)},t.prototype.setTurnLeftFastAnim=function(t,i,s){this.li(this.Y,t,i,s)},t.prototype.setStrafeRightAnim=function(t,i,s){this.li(this.st,t,i,s),this.bi(this.ht,this.st)},t.prototype.setStrafeRightFastAnim=function(t,i,s){this.li(this.ht,t,i,s)},t.prototype.setStrafeLeftAnim=function(t,i,s){this.li(this.tt,t,i,s),this.bi(this.it,this.tt)},t.prototype.setStrafeLeftFastAnim=function(t,i,s){this.li(this.it,t,i,s)},t.prototype.setIdleJumpAnim=function(t,i,s){this.li(this.T,t,i,s)},t.prototype.setRunJumpAnim=function(t,i,s){this.li(this.V,t,i,s)},t.prototype.setFallAnim=function(t,i,s){this.li(this.W,t,i,s)},t.prototype.setWalkKey=function(t){this.ut=t.toLowerCase()},t.prototype.setWalkBackKey=function(t){this.ft=t.toLowerCase()},t.prototype.setTurnLeftKey=function(t){this.ct=t.toLowerCase()},t.prototype.setTurnRightKey=function(t){this.at=t.toLowerCase()},t.prototype.setStrafeLeftKey=function(t){this.ot=t.toLowerCase()},t.prototype.setStrafeRightKey=function(t){this.rt=t.toLowerCase()},t.prototype.setJumpKey=function(t){this.lt=t.toLowerCase()},t.prototype.setCameraElasticity=function(t){this.vt=t},t.prototype.setCameraTarget=function(t){this.bt.copyFrom(t)},t.prototype.cameraCollisionChanged=function(){this.Ht=this.$t.checkCollisions},t.prototype.setNoFirstPerson=function(t){this.wt=t},t.prototype.checkAnims=function(t){for(var i=0,s=this.et;i<s.length;i++){var h=s[i];null!=t?null!=t.getAnimationRange(h.fi)&&(h.ai=!0):h.ai=!1}this.oi()},t.prototype.oi=function(){this.bi(this.N,this.K),this.bi(this.$,this.$),this.bi(this.Y,this.X),this.bi(this.ht,this.st),this.bi(this.it,this.tt)},t.prototype.bi=function(t,i){t.ai||i.ai&&(t.ai=!0,t.ci=i.ci,t.fi=i.fi,t.vi=2*i.vi)},t.prototype.setMode=function(t){this.mode=t,this.kt=t},t.prototype.setTurningOff=function(t){this.At=t},t.prototype.Xt=function(t){var i=t.getWorldMatrix(),s=h.Vector3.FromFloatArray(i.m,0),n=h.Vector3.FromFloatArray(i.m,4),e=h.Vector3.FromFloatArray(i.m,8),u=h.Vector3.Cross(s,n);h.Vector3.Dot(u,e)<0?(this.Mt=!0,this.dt=1):(this.Mt=!1,this.dt=-1)},t.prototype.setFaceForward=function(t){this.Mt?(this.wi=t?Math.PI/2:3*Math.PI/2,this.ki=t?1:-1):(this.wi=t?3*Math.PI/2:Math.PI/2,this.ki=t?-1:1)},t.prototype.checkAGs=function(t){for(var i=0,s=this.et;i<s.length;i++){var h=s[i];null!=t[h.fi]&&(h.ci=t[h.fi],h.ai=!0)}},t.prototype.start=function(){this.pt||(this.pt=!0,this.ti.reset(),this.Jt=0,this.Dt=.001,this.Ot=!1,this.Mi(),this.enableKeyBoard(!0),this.Yt.registerBeforeRender(this.ii))},t.prototype.stop=function(){this.pt&&(this.pt=!1,this.Yt.unregisterBeforeRender(this.ii),this.enableKeyBoard(!1),this.jt=null)},t.prototype.pauseAnim=function(){this.yt=!0},t.prototype.resumeAnim=function(){this.yt=!1},t.prototype.di=function(){return h.Vector3.Dot(this.Wt.forward,this.Wt.position.subtract(this.$t.position))<0?1:-1},t.prototype.si=function(){this.gt.copyFrom(this.Wt.position);var t=null,i=this.Yt.getEngine().getDeltaTime()/1e3;this.ti.pi&&!this.Rt?(this.Ot=!1,this.Dt=0,t=this.yi(i)):this.anyMovement()||this.Rt?(this.Ot=!1,this.Dt=0,t=this.ji(i)):this.Rt||(t=this.gi(i)),!this.yt&&this.Vt&&null!=t&&this.jt!==t&&(t.ai&&(this.Ut?(null!=this.jt&&this.jt.ai&&this.jt.ci.stop(),t.ci.play(t.ri),t.ci.speedRatio=t.vi):this.Zt.beginAnimation(t.fi,t.ri,t.vi)),this.jt=t),this.Mi()},t.prototype.yi=function(t){var i=null;i=this.V,0===this.Ct&&(this.St=this.Wt.position.y);var s=(this.g-this.S*this.Ct)*t-.5*this.S*t*t;this.Ct=this.Ct+t;var n,e=0;if(1==this.mode||this.At||(this.Wt.rotation.y=this.wi-this.$t.alpha),this.Bt||this.qt?(this.Bt?e=this.k*t:this.qt&&(e=this.u*t),(n=this.mi.clone()).y=0,(n=n.normalize()).scaleToRef(e,n),n.y=s):(n=new h.Vector3(0,s,0),i=this.T),this.Wt.moveWithCollisions(n),s<0)if(this.Wt.position.y>this.gt.y||this.Wt.position.y===this.gt.y&&n.length()>.001)this.Oi();else if(this.Wt.position.y<this.St){var u=this.Wt.position.subtract(this.gt);this.xi(u,n,.001)?i=this.W:this.Fi(u)<=this._&&this.Oi()}return i},t.prototype.Oi=function(){this.ti.pi=!1,this.Ct=0,this.qt=!1,this.Bt=!1},t.prototype.xi=function(t,i,s){return Math.abs(t.x-i.x)<s&&Math.abs(t.y-i.y)<s&&Math.abs(t.z-i.z)<s},t.prototype.Fi=function(t){return Math.atan(Math.abs(t.y/Math.sqrt(t.x*t.x+t.z*t.z)))},t.prototype.ji=function(t){var i=this.Jt*this.S;this.xt=i*t+this.S*t*t/2,this.Jt=this.Jt+t;var s=!1,h=null;if(this.Rt)this.mi.y=-this.xt,s=!0;else{this.qt=!1,this.Bt=!1;var n=void 0,e=0;switch(!0){case this.ti.Li:n=this.dt*this.di(),e=this.O*t,this.ti.Ri?(e=this.F*t,h=-this.ki*n>0?this.it:this.ht):h=-this.ki*n>0?this.tt:this.st,this.mi=this.Wt.calcMovePOV(n*e,-this.xt,0),s=!0;break;case this.ti.qi:n=-this.dt*this.di(),e=this.L*t,this.ti.Ri?(e=this.R*t,h=-this.ki*n>0?this.it:this.ht):h=-this.ki*n>0?this.tt:this.st,this.mi=this.Wt.calcMovePOV(n*e,-this.xt,0),s=!0;break;case this.ti.I||this.At&&0==this.mode:this.ti.Ri?(this.Bt=!0,e=this.v*t,h=this.U):(this.qt=!0,e=this.u*t,h=this.I),this.mi=this.Wt.calcMovePOV(0,-this.xt,this.ki*e),s=!0;break;case this.ti.Bi:e=this.M*t,this.ti.Ri?(e=this.j*t,h=this.N):h=this.K,this.mi=this.Wt.calcMovePOV(0,-this.xt,-this.ki*e),s=!0}}if((!this.At||0!=this.mode)&&!this.ti.Li&&!this.ti.qi&&(this.ti.X||this.ti.Z)){var u=this.q*t;if(this.ti.Ri&&(u*=2),1==this.mode){this.zt||(this._t=-this.ki*this.di(),this.Mt&&(this._t=-this._t),this.zt=!0);var f=this._t;this.ti.X?this.ti.I||(this.ti.Bi?f=-this._t:h=this._t>0?this.Z:this.X):this.ti.I?f=-this._t:this.ti.Bi||(f=-this._t,h=this._t>0?this.X:this.Z),this.Wt.rotation.y=this.Wt.rotation.y+u*f}else{f=1;this.ti.X?(this.ti.Bi&&(f=-1),s||(h=this.X)):(this.ti.I&&(f=-1),s||(f=-1,h=this.Z)),this.$t.alpha=this.$t.alpha+u*f}}if(1!=this.mode)if(this.At)switch(!0){case this.ti.I&&this.ti.Z:this.Wt.rotation.y=this.wi-this.$t.alpha+Math.PI/4;break;case this.ti.I&&this.ti.X:this.Wt.rotation.y=this.wi-this.$t.alpha-Math.PI/4;break;case this.ti.Bi&&this.ti.Z:this.Wt.rotation.y=this.wi-this.$t.alpha+3*Math.PI/4;break;case this.ti.Bi&&this.ti.X:this.Wt.rotation.y=this.wi-this.$t.alpha-3*Math.PI/4;break;case this.ti.I:this.Wt.rotation.y=this.wi-this.$t.alpha;break;case this.ti.Bi:this.Wt.rotation.y=this.wi-this.$t.alpha+Math.PI;break;case this.ti.Z:this.Wt.rotation.y=this.wi-this.$t.alpha+Math.PI/2;break;case this.ti.X:this.Wt.rotation.y=this.wi-this.$t.alpha-Math.PI/2}else this.Wt.rotation.y=this.wi-this.$t.alpha;if(s&&this.mi.length()>.001)if(this.Wt.moveWithCollisions(this.mi),this.Wt.position.y>this.gt.y){var c=this.Wt.position.subtract(this.gt),a=this.Fi(c);a>=this.A?this.D>0?(0==this.G&&this.H.copyFrom(this.gt),this.G=this.G+(this.Wt.position.y-this.gt.y),this.G>this.D&&(this.G=0,this.Wt.position.copyFrom(this.H),this.Si())):(this.Wt.position.copyFrom(this.gt),this.Si()):(this.G=0,a>this._?(this.Lt=0,this.Rt=!1):this.Si())}else if(this.Wt.position.y<this.gt.y){c=this.Wt.position.subtract(this.gt);this.xi(c,this.mi,.001)?(this.Rt=!0,this.Lt++,this.Lt>this.Ft&&(h=this.W)):this.Fi(c)<=this._?this.Si():(this.Lt=0,this.Rt=!1)}else this.Si();return h},t.prototype.Si=function(){this.Jt=0,this.Lt=0,this.Rt=!1},t.prototype.gi=function(t){if(this.Ot)return this.P;this.qt=!1,this.Bt=!1,this.Jt=0;var i=this.P;if(this.Lt=0,0===t)this.xt=5;else{var s=this.Dt*this.S;this.xt=s*t+this.S*t*t/2,this.Dt=this.Dt+t}if(this.xt<.01)return i;var n=new h.Vector3(0,-this.xt,0);if(1==this.mode||this.At||(this.Wt.rotation.y=this.wi-this.$t.alpha),this.Wt.moveWithCollisions(n),this.Wt.position.y>this.gt.y||this.Wt.position.y===this.gt.y)this.Ci();else if(this.Wt.position.y<this.gt.y){var e=this.Wt.position.subtract(this.gt);this.xi(e,n,.001)||(this.Fi(e)<=this._?(this.Ci(),this.Wt.position.copyFrom(this.gt)):(this.Ji(),i=this.nt))}return i},t.prototype.Ci=function(){this.Et++,this.Et>this.Gt&&(this.Ot=!0,this.Dt=0)},t.prototype.Ji=function(){this.Ot=!1,this.Et=0},t.prototype.Mi=function(){0==this.G&&this.Wt.position.addToRef(this.bt,this.$t.target),this.$t.radius>this.$t.lowerRadiusLimit&&this.vt&&this._i(),this.$t.radius<=this.$t.lowerRadiusLimit?this.wt||this.It||(this.Wt.visibility=0,this.$t.checkCollisions=!1,this.kt=this.mode,this.mode=0,this.It=!0):(this.It=!1,this.mode=this.kt,this.Wt.visibility=1,this.$t.checkCollisions=this.Ht)},t.prototype._i=function(){var t=this;this.$t.position.subtractToRef(this.$t.target,this.Nt),this.Kt.origin=this.$t.target,this.Kt.length=this.Nt.length(),this.Kt.direction=this.Nt.normalize();var i=this.Yt.pickWithRay(this.Kt,(function(i){return!(i==t.Wt||!i.checkCollisions)}),!0);if(i.hit)if(this.$t.checkCollisions){var s=this.$t.target.subtract(i.pickedPoint).normalize().scale(this.Pt);i.pickedPoint.addToRef(s,this.$t.position)}else{var h=i.pickedPoint.subtract(this.$t.target).length();this.$t.radius=h-this.Pt}},t.prototype.anyMovement=function(){return this.ti.I||this.ti.Bi||this.ti.X||this.ti.Z||this.ti.Li||this.ti.qi},t.prototype.ui=function(t){if(t.key&&!t.repeat){switch(t.key.toLowerCase()){case this.lt:this.ti.pi=!0;break;case"capslock":this.ti.Ri=!this.ti.Ri;break;case"shift":this.ti.Ri=!0;break;case"up":case"arrowup":case this.ut:this.ti.I=!0;break;case"left":case"arrowleft":case this.ct:this.ti.X=!0;break;case"right":case"arrowright":case this.at:this.ti.Z=!0;break;case"down":case"arrowdown":case this.ft:this.ti.Bi=!0;break;case this.ot:this.ti.Li=!0;break;case this.rt:this.ti.qi=!0}this.Tt=this.anyMovement()}},t.prototype.ni=function(t){if(t.key){switch(t.key.toLowerCase()){case"shift":this.ti.Ri=!1;break;case"up":case"arrowup":case this.ut:this.ti.I=!1;break;case"left":case"arrowleft":case this.ct:this.ti.X=!1,this.zt=!1;break;case"right":case"arrowright":case this.at:this.ti.Z=!1,this.zt=!1;break;case"down":case"arrowdown":case this.ft:this.ti.Bi=!1;break;case this.ot:this.ti.Li=!1;break;case this.rt:this.ti.qi=!1}this.Tt=this.anyMovement()}},t.prototype.enableKeyBoard=function(t){var i=this.Yt.getEngine().getRenderingCanvas();t?(i.addEventListener("keyup",this.hi,!1),i.addEventListener("keydown",this.ei,!1)):(i.removeEventListener("keyup",this.hi,!1),i.removeEventListener("keydown",this.ei,!1))},t.prototype.walk=function(t){this.ti.I=t},t.prototype.walkBack=function(t){this.ti.Bi=t},t.prototype.walkBackFast=function(t){this.ti.Bi=t,this.ti.Ri=t},t.prototype.run=function(t){this.ti.I=t,this.ti.Ri=t},t.prototype.turnLeft=function(t){this.ti.X=t,t||(this.zt=t)},t.prototype.turnLeftFast=function(t){this.ti.X=t,t||(this.zt=t),this.ti.Ri=t},t.prototype.turnRight=function(t){this.ti.Z=t,t||(this.zt=t)},t.prototype.turnRightFast=function(t){this.ti.Z=t,t||(this.zt=t),this.ti.Ri=t},t.prototype.strafeLeft=function(t){this.ti.Li=t},t.prototype.strafeLeftFast=function(t){this.ti.Li=t,this.ti.Ri=t},t.prototype.strafeRight=function(t){this.ti.qi=t},t.prototype.strafeRightFast=function(t){this.ti.qi=t,this.ti.Ri=t},t.prototype.jump=function(){this.ti.pi=!0},t.prototype.idle=function(){this.ti.reset()},t}(),e=function(t){this.ri=!0,this.vi=1,this.ai=!1,this.fi=t},u=function(){function t(){this.I=!1,this.Bi=!1,this.Ri=!1,this.Z=!1,this.X=!1,this.qi=!1,this.Li=!1,this.pi=!1,this.reset()}return t.prototype.reset=function(){this.I=!1,this.Bi=!1,this.Z=!1,this.X=!1,this.qi=!1,this.Li=!1,this.pi=!1,this.Ri=!1},t}()}])}));
//# sourceMappingURL=CharacterController.js.map